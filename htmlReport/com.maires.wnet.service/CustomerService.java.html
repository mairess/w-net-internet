<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="pt"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CustomerService.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">java in w-net-internet Coverage Results</a> &gt; <a href="index.source.html" class="el_package">com.maires.wnet.service</a> &gt; <span class="el_source">CustomerService.java</span></div><h1>CustomerService.java</h1><pre class="source lang-java linenums">package com.maires.wnet.service;

import com.maires.wnet.entity.Address;
import com.maires.wnet.entity.Customer;
import com.maires.wnet.entity.Installation;
import com.maires.wnet.repository.AddressRepository;
import com.maires.wnet.repository.CustomerRepository;
import com.maires.wnet.repository.EquipmentRepository;
import com.maires.wnet.service.exception.CustomerNotFoundException;
import jakarta.transaction.Transactional;
import java.util.List;
import java.util.Objects;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

/**
 * The type Customer service.
 */
@Service
public class CustomerService {

  private final CustomerRepository customerRepository;
  private final EquipmentRepository equipmentRepository;
  private final AddressRepository addressRepository;


  /**
   * Instantiates a new Customer service.
   *
   * @param customerRepository  the customer repository
   * @param equipmentRepository the equipment repository
   * @param addressRepository   the address repository
   */
  @Autowired
  public CustomerService(
      CustomerRepository customerRepository,
      EquipmentRepository equipmentRepository,
      AddressRepository addressRepository
<span class="fc" id="L39">  ) {</span>
<span class="fc" id="L40">    this.customerRepository = customerRepository;</span>
<span class="fc" id="L41">    this.equipmentRepository = equipmentRepository;</span>
<span class="fc" id="L42">    this.addressRepository = addressRepository;</span>
<span class="fc" id="L43">  }</span>


  /**
   * Find all customers list.
   *
   * @return the list
   */
  public List&lt;Customer&gt; findAllCustomers() {
<span class="fc" id="L52">    return customerRepository.findAll();</span>
  }

  /**
   * Find customer by id customer.
   *
   * @param customerId the customer id
   * @return the customer
   * @throws CustomerNotFoundException the customer not found exception
   */
  public Customer findCustomerById(Long customerId) throws CustomerNotFoundException {
<span class="fc" id="L63">    return customerRepository.findById(customerId)</span>
<span class="fc" id="L64">        .orElseThrow(() -&gt; new CustomerNotFoundException(customerId.toString()));</span>
  }

  /**
   * Find customer addresses list.
   *
   * @param customerId the customer id
   * @return the list
   * @throws CustomerNotFoundException the customer not found exception
   */
  public List&lt;Address&gt; findCustomerAddresses(Long customerId) throws CustomerNotFoundException {

<span class="fc" id="L76">    Customer customer = customerRepository</span>
<span class="fc" id="L77">        .findById(customerId)</span>
<span class="fc" id="L78">        .orElseThrow(() -&gt; new CustomerNotFoundException(customerId.toString()));</span>

<span class="fc" id="L80">    return customer.getAddresses();</span>
  }

  /**
   * Create customer customer.
   *
   * @param customer the customer
   * @return the customer
   */
  public Customer createCustomer(Customer customer) {
<span class="fc" id="L90">    return customerRepository.save(customer);</span>
  }

  /**
   * Update customer customer.
   *
   * @param customerId the customer id
   * @param customer   the customer
   * @return the customer
   * @throws CustomerNotFoundException the customer not found exception
   */
  public Customer updateCustomer(Long customerId, Customer customer)
      throws CustomerNotFoundException {
<span class="fc" id="L103">    Customer customerToUpdate = findCustomerById(customerId);</span>

<span class="fc" id="L105">    customerToUpdate.setFullName(customer.getFullName());</span>
<span class="fc" id="L106">    customerToUpdate.setCpf(customer.getCpf());</span>
<span class="fc" id="L107">    customerToUpdate.setPhone(customer.getPhone());</span>
<span class="fc" id="L108">    customerToUpdate.setEmail(customer.getEmail());</span>

<span class="fc" id="L110">    return customerRepository.save(customerToUpdate);</span>
  }


  /**
   * Create customer address.
   *
   * @param customerId the customer id
   * @param address    the address
   * @return the address
   * @throws CustomerNotFoundException the customer not found exception
   */
  public Address createCustomerAddress(Long customerId, Address address)
      throws CustomerNotFoundException {

<span class="fc" id="L125">    Customer customer = customerRepository.findById(customerId)</span>
<span class="fc" id="L126">        .orElseThrow(() -&gt; new CustomerNotFoundException(customerId.toString()));</span>

<span class="fc" id="L128">    address.setCustomer(customer);</span>

<span class="fc" id="L130">    return addressRepository.save(address);</span>
  }

  /**
   * Remove customer by id customer.
   *
   * @param customerId the customer id
   * @return the customer
   * @throws CustomerNotFoundException the customer not found exception
   */
  @Transactional
  public Customer removeCustomerById(Long customerId) throws CustomerNotFoundException {
<span class="fc" id="L142">    Customer deletedCustomer = findCustomerById(customerId);</span>

<span class="fc" id="L144">    deletedCustomer.getAddresses().stream()</span>
<span class="fc" id="L145">        .map(Address::getInstallation)</span>
<span class="fc" id="L146">        .filter(Objects::nonNull)</span>
<span class="fc" id="L147">        .map(Installation::getEquipments)</span>
<span class="fc" id="L148">        .flatMap(List::stream)</span>
<span class="fc" id="L149">        .forEach(equipment -&gt; {</span>
<span class="nc" id="L150">          equipment.setInstallation(null);</span>
<span class="nc" id="L151">          equipmentRepository.save(equipment);</span>
<span class="nc" id="L152">        });</span>

<span class="fc" id="L154">    customerRepository.delete(deletedCustomer);</span>
<span class="fc" id="L155">    return deletedCustomer;</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>